<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.chart.PieChart?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<BorderPane xmlns:fx="http://javafx.com/fxml"
            fx:controller="controller.CategoryController"
            stylesheets="@../css/category.css"
            prefHeight="850.0" prefWidth="1400.0"
            style="-fx-background-color: #0F1419;">

    <!-- TOP BAR -->
    <top>
        <VBox>
            <!-- Toolbar -->
            <HBox styleClass="top-bar" alignment="CENTER_LEFT" spacing="20">
                <padding>
                    <Insets top="15" right="30" bottom="15" left="30"/>
                </padding>

                <Label text="ðŸ“š Gestion des CatÃ©gories" styleClass="page-title">
                    <font>
                        <Font name="System Bold" size="24"/>
                    </font>
                </Label>
                <Pane HBox.hgrow="ALWAYS"/>
                <Button text="ðŸ”„ RafraÃ®chir" onAction="#onRefresh" styleClass="refresh-button">
                    <font>
                        <Font name="System Bold" size="13"/>
                    </font>
                </Button>
                <Button text="â† Dashboard" onAction="#backToDashboard" styleClass="back-button">
                    <font>
                        <Font name="System Bold" size="14"/>
                    </font>
                </Button>
            </HBox>

            <!-- Statistics Bar -->
            <HBox styleClass="stats-bar" alignment="CENTER_LEFT" spacing="40">
                <padding>
                    <Insets top="15" right="30" bottom="15" left="30"/>
                </padding>

                <VBox alignment="CENTER_LEFT" spacing="5">
                    <Label text="Total CatÃ©gories" style="-fx-text-fill: #B0BEC5; -fx-font-size: 12px;">
                        <font>
                            <Font size="12"/>
                        </font>
                    </Label>
                    <Label fx:id="totalCategoriesLabel" text="0" style="-fx-text-fill: #32be8f; -fx-font-size: 28px; -fx-font-weight: bold;">
                        <font>
                            <Font name="System Bold" size="28"/>
                        </font>
                    </Label>
                </VBox>

                <Separator orientation="VERTICAL" style="-fx-background-color: #37474F;"/>

                <VBox alignment="CENTER_LEFT" spacing="5">
                    <Label text="Livres Totaux" style="-fx-text-fill: #B0BEC5; -fx-font-size: 12px;">
                        <font>
                            <Font size="12"/>
                        </font>
                    </Label>
                    <Label fx:id="totalBooksLabel" text="0" style="-fx-text-fill: #2196F3; -fx-font-size: 28px; -fx-font-weight: bold;">
                        <font>
                            <Font name="System Bold" size="28"/>
                        </font>
                    </Label>
                </VBox>

                <Separator orientation="VERTICAL" style="-fx-background-color: #37474F;"/>

                <VBox alignment="CENTER_LEFT" spacing="5">
                    <Label text="CatÃ©gorie la Plus Populaire" style="-fx-text-fill: #B0BEC5; -fx-font-size: 12px;">
                        <font>
                            <Font size="12"/>
                        </font>
                    </Label>
                    <Label fx:id="mostPopularLabel" text="N/A" style="-fx-text-fill: #FFD700; -fx-font-size: 20px; -fx-font-weight: bold;">
                        <font>
                            <Font name="System Bold" size="20"/>
                        </font>
                    </Label>
                </VBox>

                <Separator orientation="VERTICAL" style="-fx-background-color: #37474F;"/>

                <VBox alignment="CENTER_LEFT" spacing="5">
                    <Label text="CatÃ©gories Vides" style="-fx-text-fill: #B0BEC5; -fx-font-size: 12px;">
                        <font>
                            <Font size="12"/>
                        </font>
                    </Label>
                    <Label fx:id="emptyLabel" text="0" style="-fx-text-fill: #F44336; -fx-font-size: 28px; -fx-font-weight: bold;">
                        <font>
                            <Font name="System Bold" size="28"/>
                        </font>
                    </Label>
                </VBox>
            </HBox>
        </VBox>
    </top>

    <!-- MAIN CONTENT -->
    <center>
        <HBox spacing="20" style="-fx-background-color: #0F1419;">
            <padding>
                <Insets top="20" right="20" bottom="20" left="20"/>
            </padding>

            <!-- Left: Table -->
            <VBox spacing="15" HBox.hgrow="ALWAYS">
                <VBox styleClass="content-card">
                    <padding>
                        <Insets top="20" right="20" bottom="20" left="20"/>
                    </padding>

                    <Label text="ðŸ“‹ Liste des CatÃ©gories" styleClass="section-title">
                        <font>
                            <Font name="System Bold" size="18"/>
                        </font>
                    </Label>

                    <TableView fx:id="categoryTable" VBox.vgrow="ALWAYS" styleClass="category-table">
                        <columns>
                            <TableColumn fx:id="colCategory" text="ðŸ“š CatÃ©gorie" prefWidth="250" minWidth="200" style="-fx-alignment: CENTER-LEFT;"/>
                            <TableColumn fx:id="colBookCount" text="ðŸ“ŠLivres" prefWidth="150" minWidth="120" style="-fx-alignment: CENTER;"/>
                            <TableColumn fx:id="colPercentage" text="ðŸ“ˆ Pourcentage" prefWidth="150" minWidth="120" style="-fx-alignment: CENTER;"/>
                            <TableColumn fx:id="colActions" text="âš™ï¸ Actions" prefWidth="120" minWidth="100" style="-fx-alignment: CENTER;"/>
                        </columns>
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                        </columnResizePolicy>
                    </TableView>
                </VBox>

                <!-- Add Category Section -->
                <VBox styleClass="content-card" spacing="15">
                    <padding>
                        <Insets top="20" right="20" bottom="20" left="20"/>
                    </padding>

                    <Label text="âž• Ajouter une Nouvelle CatÃ©gorie" styleClass="section-title">
                        <font>
                            <Font name="System Bold" size="16"/>
                        </font>
                    </Label>

                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <TextField fx:id="categoryField" promptText="Nom de la nouvelle catÃ©gorie..." styleClass="category-input" HBox.hgrow="ALWAYS">
                            <font>
                                <Font size="14"/>
                            </font>
                        </TextField>
                        <Button text="âž• Ajouter" onAction="#onAddCategory" styleClass="add-button">
                            <font>
                                <Font name="System Bold" size="14"/>
                            </font>
                        </Button>
                    </HBox>

                    <Label fx:id="statusLabel" text="" style="-fx-font-size: 13px; -fx-font-weight: bold;">
                        <font>
                            <Font name="System Bold" size="13"/>
                        </font>
                    </Label>
                </VBox>
            </VBox>

            <!-- Right: Chart -->
            <VBox spacing="0" prefWidth="500">
                <VBox styleClass="content-card" VBox.vgrow="ALWAYS">
                    <padding>
                        <Insets top="20" right="20" bottom="20" left="20"/>
                    </padding>

                    <Label text="ðŸ“Š Distribution Visuelle" styleClass="section-title">
                        <font>
                            <Font name="System Bold" size="18"/>
                        </font>
                    </Label>

                    <PieChart fx:id="categoryChart" VBox.vgrow="ALWAYS" legendVisible="true" styleClass="category-chart"/>
                </VBox>
            </VBox>
        </HBox>
    </center>

    <!-- BOTTOM STATUS BAR -->
    <bottom>
        <HBox alignment="CENTER" spacing="10" styleClass="status-bar">
            <padding>
                <Insets top="12" right="20" bottom="12" left="20"/>
            </padding>
            <Label fx:id="statsLabel" text="ðŸ“Š Chargement des statistiques..." style="-fx-text-fill: #90CAF9; -fx-font-size: 13px; -fx-font-weight: bold;">
                <font>
                    <Font name="System Bold" size="13"/>
                </font>
            </Label>
        </HBox>
    </bottom>
</BorderPane>
